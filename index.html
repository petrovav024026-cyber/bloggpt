<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Content Suite ‚Äì –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ—Å—Ç–æ–≤</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="px-6 py-4 bg-white shadow">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <h1 class="text-2xl font-bold">Content Suite <span class="text-slate-400 text-base">/ UI</span></h1>
      <nav class="text-sm">
        <a class="hover:underline" href="/docs" target="_blank">/docs</a>
        <span class="mx-2 text-slate-300">|</span>
        <a class="hover:underline" href="/ready" target="_blank">/ready</a>
        <span class="mx-2 text-slate-300">|</span>
        <a class="hover:underline" href="/health" target="_blank">/health</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-6 grid md:grid-cols-2 gap-6">
    <!-- Form -->
    <section class="bg-white rounded-2xl shadow p-6">
      <h2 class="text-xl font-semibold mb-4">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h2>

      <form id="genForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">–¢–µ–º–∞ –ø–æ—Å—Ç–∞ *</label>
          <input id="topic" required class="w-full border rounded-xl px-3 py-2" placeholder="AI —Ç—Ä–µ–Ω–¥—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö">
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">–¶–µ–ª—å (–ø—Ä–µ—Å–µ—Ç)</label>
            <select id="goal" class="w-full border rounded-xl px-3 py-2">
              <option value="">‚Äî</option>
              <option>news</option>
              <option>traffic</option>
              <option>leads</option>
              <option>brand</option>
              <option>offer</option>
              <option>expert_tip</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">–î–ª–∏–Ω–∞</label>
            <select id="length" class="w-full border rounded-xl px-3 py-2">
              <option>short</option>
              <option selected>medium</option>
              <option>long</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">–Ø–∑—ã–∫</label>
            <input id="language" value="ru" class="w-full border rounded-xl px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">–ù–æ–≤–æ—Å—Ç–∏ (—à—Ç.)</label>
            <input id="news_limit" type="number" min="0" max="10" value="3"
                   class="w-full border rounded-xl px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">–Ø–∑—ã–∫ –Ω–æ–≤–æ—Å—Ç–µ–π</label>
            <input id="news_language" placeholder="ru / en" class="w-full border rounded-xl px-3 py-2">
          </div>
        </div>

        <details class="rounded-xl border p-4 bg-slate-50">
          <summary class="cursor-pointer font-medium">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</summary>
          <div class="mt-4 space-y-3">
            <div>
              <label class="block text-sm mb-1">–¢–æ–Ω (–∫–ª—é—á –∏–ª–∏ —Ç–µ–∫—Å—Ç)</label>
              <input id="tone" class="w-full border rounded-xl px-3 py-2" placeholder="witty_brisk / serious_trust ...">
            </div>
            <div>
              <label class="block text-sm mb-1">–ê—É–¥–∏—Ç–æ—Ä–∏—è (–∫–ª—é—á –∏–ª–∏ —Ç–µ–∫—Å—Ç)</label>
              <input id="audience" class="w-full border rounded-xl px-3 py-2" placeholder="smm_founders / devs_ai ...">
            </div>
            <div>
              <label class="block text-sm mb-1">–¢–µ–º–∞—Ç–∏–∫–∞</label>
              <select id="theme" class="w-full border rounded-xl px-3 py-2">
                <option value="">‚Äî</option>
                <option>leads</option>
                <option>traffic</option>
                <option>ironic</option>
              </select>
            </div>
            <div>
              <label class="block text-sm mb-1">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
              <input id="keywords" class="w-full border rounded-xl px-3 py-2" placeholder="–≥–∞–π–¥, —á–µ–∫-–ª–∏—Å—Ç">
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm mb-1">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</label>
                <input id="temperature" type="number" step="0.1" min="0" max="2" value="0.7"
                       class="w-full border rounded-xl px-3 py-2">
              </div>
              <label class="flex items-center gap-2 mt-6">
                <input id="make_image" type="checkbox" class="w-4 h-4">
                <span class="text-sm">–°–¥–µ–ª–∞—Ç—å –æ–±–ª–æ–∂–∫—É (OpenAI Images)</span>
              </label>
            </div>
          </div>
        </details>

        <div class="flex gap-3 pt-2">
          <button id="runBtn" type="submit"
            class="px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50">
            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
          </button>
          <button type="button" id="copyBtn"
            class="px-4 py-2 rounded-xl border hover:bg-slate-100">
            –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
          </button>
        </div>
        <p id="status" class="text-sm text-slate-500 pt-2"></p>
      </form>
    </section>

    <!-- Result -->
    <section class="bg-white rounded-2xl shadow p-6">
      <h2 class="text-xl font-semibold mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
      <div id="result" class="space-y-4">
        <div id="titleBox" class="hidden">
          <div class="text-sm uppercase tracking-wide text-slate-400">–ó–∞–≥–æ–ª–æ–≤–æ–∫</div>
          <h3 id="resTitle" class="text-2xl font-bold"></h3>
        </div>

        <div id="postBox" class="hidden">
          <div class="text-sm uppercase tracking-wide text-slate-400">–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞</div>
          <pre id="resPost" class="whitespace-pre-wrap bg-slate-50 p-3 rounded-xl border"></pre>
        </div>

        <div id="ctaBox" class="hidden">
          <div class="text-sm uppercase tracking-wide text-slate-400">CTA</div>
          <div id="resCta" class="p-3 rounded-xl border bg-amber-50"></div>
        </div>

        <div id="hashBox" class="hidden">
          <div class="text-sm uppercase tracking-wide text-slate-400">–•—ç—à—Ç–µ–≥–∏</div>
          <div id="resTags" class="flex flex-wrap gap-2"></div>
        </div>

        <div id="linkBox" class="hidden">
          <div class="text-sm uppercase tracking-wide text-slate-400">UTM-—Å—Å—ã–ª–∫–∞</div>
          <a id="resLink" href="#" target="_blank" class="text-indigo-700 underline break-all"></a>
        </div>

        <div id="imgBox" class="hidden">
          <div class="text-sm uppercase tracking-wide text-slate-400">–û–±–ª–æ–∂–∫–∞</div>
          <img id="resImg" class="rounded-xl border max-h-72" alt="generated cover" />
          <div class="text-xs text-slate-500 mt-1" id="imgNote"></div>
        </div>

        <div id="statsBox" class="hidden">
          <div class="text-sm uppercase tracking-wide text-slate-400">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
          <div class="text-sm bg-slate-50 p-3 rounded-xl border" id="resStats"></div>
        </div>

        <div id="newsBox" class="hidden">
          <div class="text-sm uppercase tracking-wide text-slate-400">–ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–µ–π (Currents)</div>
          <ul id="resNews" class="list-disc list-inside space-y-1"></ul>
        </div>

        <div class="pt-2">
          <details>
            <summary class="cursor-pointer text-sm text-slate-500">–°—ã—Ä–æ–π JSON-–æ—Ç–≤–µ—Ç</summary>
            <pre id="rawJson" class="text-xs bg-slate-50 p-3 rounded-xl border overflow-x-auto"></pre>
          </details>
        </div>
      </div>
    </section>
  </main>

  <footer class="max-w-6xl mx-auto p-6 text-center text-xs text-slate-500">
    v1 ‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ FastAPI + Render ‚Ä¢ –ï—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ —É—Å–Ω—É–ª–∞, –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 50+ —Å–µ–∫ –Ω–∞ Free –ø–ª–∞–Ω–µ
  </footer>

  <script>
    const $ = (id) => document.getElementById(id);

    function pick(val) {
      return val === "" ? undefined : val;
    }

    function chips(tags) {
      return (tags || []).map(t => `<span class="px-2 py-1 rounded-lg bg-slate-100 border">#${t}</span>`).join(" ");
    }

    $("genForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      $("runBtn").disabled = true;
      $("status").textContent = "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è‚Ä¶";
      const body = {
        topic: $("topic").value,
        goal: pick($("goal").value),
        length: $("length").value,
        language: $("language").value,
        news_limit: parseInt($("news_limit").value || "0", 10),
        news_language: pick($("news_language").value),
        tone: pick($("tone").value),
        audience: pick($("audience").value),
        theme: pick($("theme").value),
        keywords: pick($("keywords").value)?.split(",").map(s => s.trim()).filter(Boolean),
        temperature: parseFloat($("temperature").value || "0.7"),
        make_image: $("make_image").checked
      };

      try {
        const res = await fetch("/generate", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(body)
        });
        const data = await res.json();
        $("rawJson").textContent = JSON.stringify(data, null, 2);

        if (!res.ok) {
          $("status").textContent = "–û—à–∏–±–∫–∞: " + (data.detail || res.status);
          return;
        }

        // Fill UI
        $("titleBox").classList.remove("hidden");
        $("resTitle").textContent = data.title || "";
        $("postBox").classList.remove("hidden");
        $("resPost").textContent = data.post || "";
        $("ctaBox").classList.remove("hidden");
        $("resCta").textContent = data.cta || "";
        $("hashBox").classList.remove("hidden");
        $("resTags").innerHTML = chips(data.hashtags);

        if (data.utm_link) {
          $("linkBox").classList.remove("hidden");
          $("resLink").href = data.utm_link;
          $("resLink").textContent = data.utm_link;
        } else {
          $("linkBox").classList.add("hidden");
        }

        if (data.image_url) {
          $("imgBox").classList.remove("hidden");
          $("resImg").src = data.image_url;
          $("imgNote").textContent = "";
        } else {
          $("imgBox").classList.add("hidden");
          $("imgNote").textContent = "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–æ—Å—å –∏–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è b64_json (–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º).";
        }

        $("statsBox").classList.remove("hidden");
        $("resStats").textContent =
          `tokens in: ${data.input_tokens} ‚Ä¢ tokens out: ${data.output_tokens} ‚Ä¢ $${data.cost_estimate}`;

        const news = data.news_used || [];
        if (news.length) {
          $("newsBox").classList.remove("hidden");
          $("resNews").innerHTML = news.map(n =>
            `<li><a class="text-indigo-700 underline" href="${n.url || '#'}" target="_blank">${n.title}</a></li>`
          ).join("");
        } else {
          $("newsBox").classList.add("hidden");
        }

        $("status").textContent = "–ì–æ—Ç–æ–≤–æ ‚úî";
      } catch (err) {
        $("status").textContent = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err;
      } finally {
        $("runBtn").disabled = false;
      }
    });

    $("copyBtn").addEventListener("click", async () => {
      const title = $("resTitle").textContent || "";
      const post = $("resPost").textContent || "";
      const cta = $("resCta").textContent ? `\n\n${$("resCta").textContent}` : "";
      const tags = Array.from($("resTags").querySelectorAll("span")).map(s => s.textContent).join(" ");
      const text = [title, post, cta, tags].filter(Boolean).join("\n\n");
      try {
        await navigator.clipboard.writeText(text);
        $("status").textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ üìã";
      } catch {
        $("status").textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å";
      }
    });
  </script>
</body>
</html>
